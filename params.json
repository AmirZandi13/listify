{"name":"Listify","tagline":"Turn any Eloquent model into a list!","body":"# Listify\r\n\r\nTurn any Eloquent model into a list!\r\n\r\n## Description\r\n\r\n`Listify` provides the capabilities for sorting and reordering a number of objects in a list. The class that has this specified needs to have a `position` column defined as an integer on the mapped database table. `Listify` is an Eloquent port of the highly useful Ruby gem `acts_as_list` (https://github.com/swanandp/acts_as_list).\r\n\r\n[![Build Status](https://secure.travis-ci.org/lookitsatravis/listify.png)](https://secure.travis-ci.org/lookitsatravis/listify)\r\n[![Coverage Status](https://coveralls.io/repos/lookitsatravis/listify/badge.png)](https://coveralls.io/r/lookitsatravis/listify)\r\n\r\n[![Latest Stable Version](https://poser.pugx.org/lookitsatravis/listify/v/stable.png)](https://packagist.org/packages/lookitsatravis/listify)\r\n\r\n* [Requirements](#requirements)\r\n* [Installation](#installation)\r\n* [Quick Start](#quickstart)\r\n* [Overview](#overview)\r\n* [Configuration](#configuration)\r\n* [Notes](#notes)\r\n* [Future Plans](#futureplans)\r\n* [Contributing](#contributing)\r\n* [Copyright](#copyright)\r\n\r\n\r\n## Requirements\r\n* `Listify` currently requires php >= 5.4 (`Listify` is implemented via the use of traits).\r\n* Laravel 4.0 or higher\r\n\r\n## Installation\r\n`Listify` is distributed as a composer package, which is how it should be used in your app.\r\n\r\nInstall the package using Composer.  Edit your project's `composer.json` file to require `lookitsatravis/listify`.\r\n\r\n```js\r\n  \"require\": {\r\n    \"laravel/framework\": \"4.x\",\r\n    \"lookitsatravis/listify\": \"1.0.x\"\r\n  }  \r\n```\r\n\r\nOnce this operation completes, the final step is to add the service provider. Open `app/config/app.php`, and add a new item to the providers array.\r\n\r\n```php\r\n    'Lookitsatravis\\Listify\\ListifyServiceProvider' \r\n```\r\n\r\n## Quickstart\r\n\r\nFirst things first, you'll need to add a column to store the position. From the command line, use the migration generator:\r\n\r\n```php\r\nphp artisan listify:attach {table_name} {position_column_name}\r\nphp artisan migrate\r\n```\r\n\r\n> `{table_name}` is a required argument. `{position_column_name}` is optional and the default value is \"position\".\r\n\r\nThen, in your model:\r\n\r\n```php\r\nclass User extends Eloquent\r\n{\r\n    use \\Lookitsatravis\\Listify\\listify;\r\n\r\n    public function __construct(array $attributes = array(), $exists = false) {\r\n\r\n        parent::__construct($attributes, $exists);\r\n\r\n        $this->initListify();\r\n    }\r\n\r\n    public static function boot()\r\n    {\r\n        parent::boot();\r\n\r\n        static::bootListify();\r\n    }\r\n}\r\n```\r\n\r\n> Make sure that the `initListify()` method is called *after* `parent::__construct()` of your model, and that `static::bootListify()` is called *after* `parent::boot()`.\r\n\r\nThat's all it takes to get access to the `Listify` hotness.\r\n\r\n## Overview\r\n\r\n### Instance Methods Added To Eloquent Models\r\n\r\nYou'll have a number of methods added to each instance of the Eloquent model to which `Listify` is added. \r\n\r\nIn `Listify`, \"higher\" means further up the list (a lower `position`), and \"lower\" means further down the list (a higher `position`). That can be confusing, so it might make sense to add tests that validate that you're using the right method given your context.\r\n\r\n#### Methods That Change Position and Reorder List\r\n\r\n- `eloquentModel.insertAt(2)`\r\n- `eloquentModel.moveLower()` will do nothing if the item is the lowest item\r\n- `eloquentModel.moveHigher()` will do nothing if the item is the highest item\r\n- `eloquentModel.moveToBottom()`\r\n- `eloquentModel.moveToTop()`\r\n- `eloquentModel.removeFromList()`\r\n\r\n#### Methods That Change Position Without Reordering List Immediately\r\n###### Note: a changed position will still trigger updates to other items in the list once the model is saved\r\n\r\n- `eloquentModel.incrementPosition()`\r\n- `eloquentModel.decrementPosition()`\r\n- `eloquentModel.setListPosition(3)`\r\n\r\n#### Methods That Return Attributes of the Item's List Position\r\n- `eloquentModel.isFirst()`\r\n- `eloquentModel.isLast()`\r\n- `eloquentModel.isInList()`\r\n- `eloquentModel.isNotInList()`\r\n- `eloquentModel.isDefaultPosition()`\r\n- `eloquentModel.higherItem()`\r\n- `eloquentModel.higherItems()` will return all the items above `eloquentModel` in the list (ordered by the position, ascending)\r\n- `eloquentModel.lowerItem()`\r\n- `eloquentModel.lowerItems()` will return all the items below `eloquentModel` in the list (ordered by the position, ascending)\r\n\r\n##Configuration\r\n\r\nThere are a few configuration options available. You'll need to pass these in as an array argument for `initListify()` in your model's constructor. Here are the options:\r\n\r\n- `top_of_list` sets the integer position for the top of the list (default: `1`).\r\n- `column` sets the name of your position column that you chose during installation (default: `'position'`).\r\n- `add_new_at` sets the name of your position column that you chose during installation (default: `'bottom'`, options: `'top'` or `'bottom'`).\r\n- `scope` allows you to scope the items in your list. This one requires a bit of elaboration. There are three posible values accepted:\r\n    - `string`\r\n    - `Illuminate\\Database\\Eloquent\\Relations\\BelongsTo` object\r\n    - `Illuminate\\Database\\Query\\Builder` object\r\n\r\n***\r\n\r\n###String\r\n\r\nIf `string` is passed in, a raw string is passed in as a `whereRaw` to the scope. This allows you to do something like `'custom_foreign_key = 42'` and have all of the items scoped to that result set. You can pass as complicated of a where clause as you want, and it will be passed straight into each DB operation.\r\n\r\nExample:\r\n\r\n```php\r\nclass User extends Eloquent\r\n{\r\n    use \\Lookitsatravis\\Listify\\listify;\r\n\r\n    public function __construct(array $attributes = array(), $exists = false) {\r\n\r\n        parent::__construct($attributes, $exists);\r\n\r\n        $this->initListify([\r\n            'scope' => 'answer_to_ltuae = 42'\r\n        ]);\r\n    }\r\n\r\n    public static function boot()\r\n    {\r\n        parent::boot();\r\n\r\n        static::bootListify();\r\n    }\r\n}\r\n```\r\n\r\nResults in a scope of:\r\n\r\n`WHERE answer_to_ltuae = 42`\r\n\r\n***\r\n\r\n###Illuminate\\Database\\Eloquent\\Relations\\BelongsTo\r\n\r\nIf `Illuminate\\Database\\Eloquent\\Relations\\BelongsTo` is passed in, `Listify` will match up the foreign key of the scope to the value of the corresponding foreign key of the model instance.\r\n\r\nExample:\r\n\r\n```php\r\nclass ToDoListItem extends Eloquent\r\n{\r\n    use \\Lookitsatravis\\Listify\\listify;\r\n\r\n    public function __construct(array $attributes = array(), $exists = false) {\r\n\r\n        parent::__construct($attributes, $exists);\r\n\r\n        $this->initListify([\r\n            'scope' => $this->toDoList()\r\n        ]);\r\n    }\r\n\r\n    public static function boot()\r\n    {\r\n        parent::boot();\r\n\r\n        static::bootListify();\r\n    }\r\n\r\n    public function toDoList()\r\n    {\r\n        $this->belongsTo('ToDoList'); \r\n    }\r\n}\r\n```\r\n\r\nResults in a scope of:\r\n\r\n`WHERE to_do_list_id = {{value of toDoListItem.to_do_list_id}}`\r\n\r\n***\r\n\r\n###Illuminate\\Database\\Query\\Builder\r\n\r\nAnd lastly, if `Illuminate\\Database\\Query\\Builder` is passed in, `Listify` will extract the where clause of the builder and use it as the scope of the `Listify` items. This scope type was added in an attempt to keep parity between the `acts_as_list` version and `Listify`; **however, due to differences in the languages and in ActiveRecord versus Eloquent, it is a limited implementation so far and needs impovement to be more flexible and secure. This is a big limitation and will be the first thing addressed in upcoming releases.**\r\n\r\nThis one is tricky, because in order for it to work the query objects `where` array is prepared with the bindings *outside of PDO* and then passed in as a raw string. So, please keep in mind that this route can open your application up to abuse if you are not careful about how the object is built. If you use direct user input, please sanitize the data before using this as a scope for `Listify`.\r\n\r\nExample:\r\n\r\n```php\r\nclass ToDoListItem extends Eloquent\r\n{\r\n    use \\Lookitsatravis\\Listify\\listify;\r\n\r\n    public function __construct(array $attributes = array(), $exists = false) {\r\n\r\n        parent::__construct($attributes, $exists);\r\n\r\n        $this->initListify([\r\n            'scope' => DB::table($this->getTable())->where('type', '=', 'Not A List of My Favorite Porn Videos')\r\n        ]);\r\n    }\r\n\r\n    public static function boot()\r\n    {\r\n        parent::boot();\r\n\r\n        static::bootListify();\r\n    }\r\n}\r\n```\r\n\r\nResults in a scope of:\r\n\r\n`to_do_list_items.type = 'Not A List of My Favorite Porn Videos'`\r\n\r\n\r\n## Notes\r\n\r\nAll `position` queries (select, update, etc.) inside trait methods are executed without the default scope, this will prevent nasty issues when the default scope is different from `Listify` scope.\r\n\r\nThe `position` column is set after validations are called, so you should not put a `presence` validation on the `position` column.\r\n\r\n\r\n## Future Plans\r\n\r\n- Update `Illuminate\\Database\\Query\\Builder` scope to be more secure and flexible\r\n- Additional features for the install command. Things like:\r\n    - update the model with trait automatically (including init method in constructor and boot method for events)\r\n    - generate (or add to) a controller with actions for each public method for `Listify`, including adding necessary routes. This would make it easy to, say, call something like `http://localhost:8000/foos/1/move_lower` through an AJAX-y front end.\r\n\r\nAside from that, I hope to just keep in parity with the Ruby gem `acts_as_list` (https://github.com/swanandp/acts_as_list) as necessary.\r\n\r\n## Contributing to `Listify`\r\n \r\n- Check out the latest master to make sure the feature hasn't been implemented or the bug hasn't been fixed yet\r\n- Check out the issue tracker to make sure someone already hasn't requested it and/or contributed it\r\n- Fork the project\r\n- Start a feature/bugfix branch\r\n- Commit and push until you are happy with your contribution\r\n- Make sure to add tests for it. This is important so I don't break it in a future version unintentionally.\r\n- Please try not to mess with the Composer.json, version, or history. If you want to have your own version, or is otherwise necessary, that is fine, but please isolate to its own commit so I can cherry-pick around it.\r\n- I would recommend using Laravel 4.0.x and higher for testing the build before a pull request.\r\n\r\n## Copyright\r\n\r\nCopyright (c) 2013 Travis Vignon, released under the MIT license","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}